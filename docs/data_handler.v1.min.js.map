{"version":3,"file":"data_handler.v1.min.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../../js/data_handler/export_params.ts","../../../js/data_handler/checks.ts","../../../js/data_handler/filter_check.ts","../../../js/data_handler/patterns.ts","../../../js/data_handler/row_writers.ts","../../../js/data_handler/exporter.ts","../../../js/data_handler/retrievers.ts","../../../js/data_handler/formatters.ts","../../../js/data_handler/ingesters.ts","../../../js/data_handler/summary.ts","../../../js/data_handler/mappers.ts","../../../js/data_handler/parsers.ts","../../../js/data_handler/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport default {\r\n    __extends,\r\n    __assign,\r\n    __rest,\r\n    __decorate,\r\n    __param,\r\n    __metadata,\r\n    __awaiter,\r\n    __generator,\r\n    __createBinding,\r\n    __exportStar,\r\n    __values,\r\n    __read,\r\n    __spread,\r\n    __spreadArrays,\r\n    __spreadArray,\r\n    __await,\r\n    __asyncGenerator,\r\n    __asyncDelegator,\r\n    __asyncValues,\r\n    __makeTemplateObject,\r\n    __importStar,\r\n    __importDefault,\r\n    __classPrivateFieldGet,\r\n    __classPrivateFieldSet,\r\n    __classPrivateFieldIn,\r\n};\r\n","import {UnparsedObject} from '../types'\r\n\r\nexport const defaults: UnparsedObject = {\r\n  file_format: 'csv',\r\n  table_format: 'mixed',\r\n  features: {ID: 'id', Name: 'name'},\r\n  feature_conditions: [],\r\n  variables: {\r\n    filter_by: [],\r\n    conditions: [],\r\n  },\r\n}\r\n\r\nexport const options: {[index: string]: string[]} = {\r\n  file_format: ['csv', 'tsv'],\r\n  table_format: ['tall', 'mixed', 'wide'],\r\n  filter_components: ['first', 'min', 'mean', 'sum', 'max', 'last'],\r\n}\r\n","import {options} from './export_params'\r\n\r\nexport const group_checks: {[index: string]: Function} = {\r\n  '!': function (this: number, v: number): boolean {\r\n    return this !== v\r\n  },\r\n  '=': function (this: number, v: number): boolean {\r\n    return this === v\r\n  },\r\n  includes: function (v: number): boolean {\r\n    return -1 !== this.indexOf(v)\r\n  },\r\n  excludes: function (v: number): boolean {\r\n    return -1 === this.indexOf(v)\r\n  },\r\n}\r\n\r\nexport const export_checks: {[index: string]: Function} = {\r\n  file_format: function (a: string): boolean {\r\n    return -1 === options.file_format.indexOf(a)\r\n  },\r\n  table_format: function (a: string): boolean {\r\n    return -1 === options.table_format.indexOf(a)\r\n  },\r\n  include: function (a: string, vars: {[index: string]: string}): string {\r\n    for (let i = a.length; i--; ) {\r\n      if (!(a[i] in vars)) return a[i]\r\n    }\r\n    return ''\r\n  },\r\n}\r\n\r\nexport const value_checks: {[index: string]: Function} = {\r\n  '!': function (a: number): boolean {\r\n    return !a || -1 == a\r\n  },\r\n  '': function (a: number): boolean {\r\n    return !!a && -1 != a\r\n  },\r\n  '=': function (a: number, b: number): boolean {\r\n    return a === b\r\n  },\r\n  '!=': function (a: number, b: number): boolean {\r\n    return a != b\r\n  },\r\n  '>': function (a: number, b: number): boolean {\r\n    return a > b\r\n  },\r\n  '<': function (a: number, b: number): boolean {\r\n    return a < b\r\n  },\r\n  '>=': function (a: number, b: number): boolean {\r\n    return a >= b\r\n  },\r\n  '<=': function (a: number, b: number): boolean {\r\n    return a <= b\r\n  },\r\n  equals: function (s: number, e: string | number): boolean {\r\n    return !s || -1 == s || s === e\r\n  },\r\n  includes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 !== s.indexOf(e)\r\n  },\r\n  excludes: function (s: (string | number)[], e: string | number): boolean {\r\n    return !s || !s.length || -1 === s.indexOf(e)\r\n  },\r\n}\r\n","import {Filter, VariableFilter, Variables, VectorSummary, Entity} from '../types'\r\n\r\nfunction vector_summary(vec: number | number[], range: number[]): VectorSummary {\r\n  if (Array.isArray(vec)) {\r\n    const n = Math.min(range[1] + 1, vec.length),\r\n      r: VectorSummary = {\r\n        missing: 0,\r\n        first: vec[0],\r\n        min: Infinity,\r\n        mean: 0,\r\n        sum: 0,\r\n        max: -Infinity,\r\n        last: vec[n - 1],\r\n      }\r\n    let on = 0\r\n    for (let i = Math.max(range[0], 0); i < n; i++) {\r\n      const v = vec[i]\r\n      if ('number' === typeof v) {\r\n        if (isNaN(v)) {\r\n          r.missing++\r\n        } else {\r\n          on++\r\n          if (r.min > v) r.min = v\r\n          if (r.max < v) r.max = v\r\n          r.sum += v\r\n        }\r\n      } else {\r\n        if ('NA' !== v) on++\r\n      }\r\n    }\r\n    r.mean = on ? r.sum / on : 0\r\n    return r\r\n  } else {\r\n    return {missing: Number(isNaN(vec)) + 0, first: vec, min: vec, mean: vec, sum: vec, max: vec, last: vec}\r\n  }\r\n}\r\n\r\nexport function passes_filter(\r\n  entity: Entity,\r\n  time_range: number[],\r\n  filter: VariableFilter,\r\n  variables: Variables\r\n): boolean {\r\n  const s: {[index: string]: VectorSummary} = {},\r\n    adjs: {[index: string]: number} = {}\r\n  for (let i = filter.filter_by.length; i--; ) {\r\n    const f = filter.filter_by[i]\r\n    const c = variables[f].code\r\n    if (!(c in entity.data)) return false\r\n    const r =\r\n      entity.group in variables[f].info\r\n        ? variables[f].info[entity.group].time_range\r\n        : variables[f].time_range[entity.group]\r\n    if (!r) return false\r\n    adjs[f] = r[0]\r\n    s[f] = vector_summary(entity.data[c], [time_range[0] - r[0], Math.max(time_range[1] - r[0], time_range[1] - r[1])])\r\n  }\r\n  for (let i = filter.conditions.length; i--; ) {\r\n    const co = filter.conditions[i]\r\n    if (\r\n      !(co.time_component ? co.check(entity.data[variables[co.name].code], adjs[co.name] || 0) : co.check(s[co.name]))\r\n    )\r\n      return false\r\n  }\r\n  return true\r\n}\r\n\r\nexport function passes_feature_filter(entities: {[index: string]: Entity}, id: string, filter: Filter[]): boolean {\r\n  const entity = entities[id]\r\n  for (let i = filter.length; i--; ) {\r\n    const value = filter[i].value\r\n    if (value !== '-1') {\r\n      if ('id' === filter[i].name && Array.isArray(value)) {\r\n        let pass = false\r\n        value.forEach((id: string) => {\r\n          if (!pass) {\r\n            const group = id in entities && entities[id].group\r\n            if (\r\n              group && group in entity.features\r\n                ? id === entity.features[group]\r\n                : id.length < entity.features.id.length\r\n                ? id === entity.features.id.substring(0, id.length)\r\n                : id === entity.features.id\r\n            )\r\n              pass = true\r\n          }\r\n        })\r\n        return pass\r\n      } else if (!filter[i].check(entity.features[filter[i].name])) return false\r\n    }\r\n  }\r\n  return true\r\n}\r\n","export const patterns: {[index: string]: RegExp} = {\r\n  seps: /[\\s._-]/g,\r\n  comma: /,/,\r\n  word_start: /\\b(\\w)/g,\r\n  single_operator: /([<>!])([^=])/,\r\n  greater: /%3E$/,\r\n  less: /%3C$/,\r\n  operator_start: /[<>!]$/,\r\n  component: /^(.+)\\[(.+)\\]/,\r\n  number: /^[0-9.+-]+$/,\r\n  non_letter_num: /[^0-9a-z]+/g,\r\n}\r\n","import DataHandler from '.'\r\nimport {Entity, Features} from '../types'\r\n\r\nexport function tall(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      if (vc in entity.data) {\r\n        const range: [number, number] = this.meta.variables[entity.group][k].time_range\r\n        let r = ''\r\n        const yn = time_range[1] + 1\r\n        for (let y = time_range[0]; y < yn; y++) {\r\n          if (y >= range[0] && y <= range[1]) {\r\n            const vec = entity.data[vc]\r\n            const value = Array.isArray(vec) ? vec[y - range[0]] : vec\r\n            if (!isNaN(value)) {\r\n              r += (r ? '\\n' : '') + tr + time[y] + sep + '\"' + k + '\"' + sep + value\r\n            }\r\n          }\r\n        }\r\n        if (r) op.push(r)\r\n      }\r\n    })\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function mixed(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    const op: string[] = [],\r\n      time = this.meta.times[entity.group].value as number[]\r\n    let tr = ''\r\n    Object.keys(feats).forEach(f => {\r\n      tr += '\"' + entity.features[feats[f]] + '\"' + sep\r\n    })\r\n    const yn = time_range[1] + 1\r\n    for (let y = time_range[0]; y < yn; y++) {\r\n      let r = tr + time[y]\r\n      vars.forEach((k: string) => {\r\n        const vc = entity.variables[k].code\r\n        if (vc in entity.data) {\r\n          const trange = this.meta.variables[entity.group][k].time_range\r\n          const vec = entity.data[vc]\r\n          let value = NaN\r\n          if (Array.isArray(vec)) {\r\n            if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n          } else if (y === trange[0]) {\r\n            value = vec\r\n          }\r\n          r += sep + (isNaN(value) ? 'NA' : value)\r\n        } else r += sep + 'NA'\r\n      })\r\n      op.push(r)\r\n    }\r\n    return op.join('\\n')\r\n  }\r\n  return ''\r\n}\r\n\r\nexport function wide(\r\n  this: DataHandler,\r\n  entity: Entity,\r\n  time_range: number[],\r\n  feats: Features,\r\n  vars: string[],\r\n  sep: string\r\n): string {\r\n  if (entity.group in this.meta.times) {\r\n    let r = ''\r\n    Object.keys(feats).forEach(f => {\r\n      r += (r ? sep : '') + '\"' + entity.features[feats[f]] + '\"'\r\n    })\r\n    vars.forEach(k => {\r\n      const vc = entity.variables[k].code\r\n      const range: [number, number] = this.meta.ranges[k]\r\n      const trange: [number, number] = this.meta.variables[entity.group][k].time_range\r\n      const yn = time_range[1] + 1\r\n      for (let y = time_range[0]; y < yn; y++) {\r\n        if (y >= range[0] && y <= range[1]) {\r\n          if (vc in entity.data) {\r\n            const vec = entity.data[vc]\r\n            let value = NaN\r\n            if (Array.isArray(vec)) {\r\n              if (y >= trange[0] && y <= trange[1]) value = vec[y - trange[0]]\r\n            } else if (y === trange[0]) {\r\n              value = vec\r\n            }\r\n            r += sep + (isNaN(value) ? 'NA' : value)\r\n          } else r += sep + 'NA'\r\n        }\r\n      }\r\n    })\r\n    return r\r\n  }\r\n  return ''\r\n}\r\n","import * as params from './export_params'\r\nimport {group_checks, export_checks} from './checks'\r\nimport {passes_filter, passes_feature_filter} from './filter_check'\r\nimport {patterns} from './patterns'\r\nimport * as row_writers from './row_writers'\r\nimport type {Query, Entity, Features, Entities, RawQuery} from '../types'\r\nimport DataHandler from '.'\r\n\r\nexport async function exporter(\r\n  this: DataHandler,\r\n  query_string?: RawQuery,\r\n  entities?: Entities,\r\n  in_browser?: boolean,\r\n  all_data?: boolean\r\n) {\r\n  if (!in_browser) await this.data_ready\r\n  const query: Query = this.parse_query(query_string)\r\n  entities = entities || this.entities\r\n  if (-1 === params.options.file_format.indexOf(query.file_format)) query.file_format = params.defaults.file_format\r\n  if (!(query.table_format in row_writers)) query.table_format = params.defaults.table_format\r\n  const res = {\r\n      statusCode: 400,\r\n      headers: {'Content-Type': 'text/plain; charset=utf-8', 'Content-Disposition': 'attachment; filename='},\r\n      body: 'Invalid Request',\r\n    },\r\n    inc: string[] =\r\n      query.include && query.include.length\r\n        ? 'string' === typeof query.include\r\n          ? query.include.split(',')\r\n          : query.include\r\n        : Object.keys(this.variables),\r\n    exc = query.exclude || [],\r\n    vars: string[] = [],\r\n    feats: Features = query.features || JSON.parse(JSON.stringify(params.defaults.features)),\r\n    rows: string[] = [],\r\n    range = [Infinity, -Infinity],\r\n    sep = 'csv' === query.file_format ? ',' : '\\t',\r\n    rw: Function = row_writers[query.table_format].bind(this),\r\n    no_filter = !query.variables.filter_by.length,\r\n    no_feature_filter = !query.feature_conditions.length,\r\n    in_group: Function = !('dataset' in query)\r\n      ? () => true\r\n      : group_checks[query.dataset.operator].bind(query.dataset.value)\r\n  inc.forEach((ii: string) => {\r\n    if (ii in this.features && !(ii in feats)) {\r\n      feats[ii] = this.format_label(ii)\r\n    }\r\n  })\r\n  for (const k in export_checks)\r\n    if (k in query) {\r\n      const r: string = export_checks[k]('include' === k ? inc : query[k as keyof Query], this.variables)\r\n      if (r) {\r\n        res.body = 'Failed check for ' + k + ': ' + r\r\n        return res\r\n      }\r\n    }\r\n  Object.keys(this.variable_codes).forEach((k: string) => {\r\n    if (-1 !== inc.indexOf(this.variable_codes[k].name) && -1 === exc.indexOf(this.variable_codes[k].name)) {\r\n      vars.push(this.variable_codes[k].name)\r\n      const tr: [number, number] = this.meta.ranges[this.variable_codes[k].name]\r\n      if (tr[0] < range[0]) range[0] = tr[0]\r\n      if (tr[1] > range[1]) range[1] = tr[1]\r\n    }\r\n  })\r\n  if (query.time_range[0] < range[0]) query.time_range[0] = range[0]\r\n  if (query.time_range[1] > range[1]) query.time_range[1] = range[1]\r\n  rows.push(Object.keys(feats).join(sep))\r\n  if ('wide' === query.table_format) {\r\n    vars.forEach((vi: string) => {\r\n      const tr: [number, number] = this.meta.ranges[vi],\r\n        yn = Math.min(query.time_range[1], tr[1]) + 1\r\n      for (let y = Math.max(query.time_range[0], tr[0]); y < yn; y++) {\r\n        rows[0] += sep + vi + '_' + this.meta.overall.value[y]\r\n      }\r\n    })\r\n  } else rows[0] += sep + 'time' + sep + ('mixed' === query.table_format ? vars : ['variable', 'value']).join(sep)\r\n  let first_entity = ''\r\n  Object.keys(entities).forEach((k: string) => {\r\n    const e: Entity = entities[k]\r\n    if (\r\n      in_group(e.group) &&\r\n      (no_feature_filter || passes_feature_filter(entities, k, query.feature_conditions)) &&\r\n      (no_filter || passes_filter(e, query.time_range, query.variables, this.variables))\r\n    ) {\r\n      const r: string = rw(e, query.time_range, feats, vars, sep)\r\n      if (r) {\r\n        if (!first_entity) first_entity = k\r\n        rows.push(r)\r\n      }\r\n    }\r\n  })\r\n  res.headers['Content-Type'] = 'text/' + (',' === sep ? 'csv' : 'plain') + '; charset=utf-8'\r\n  res.body = rows.join('\\n')\r\n  const times: number[] = this.meta.overall.value,\r\n    filename =\r\n      'export_' +\r\n      (in_browser && !all_data && first_entity\r\n        ? entities[first_entity].group + '_'\r\n        : query.dataset\r\n        ? query.dataset.value + '_'\r\n        : '') +\r\n      (query.time_range[0] === query.time_range[1]\r\n        ? times[query.time_range[0]]\r\n        : times[query.time_range[0]] + '-' + times[query.time_range[1]]) +\r\n      '_' +\r\n      (1 === vars.length\r\n        ? this.variables[vars[0]].meta.short_name.toLowerCase().replace(patterns.non_letter_num, '-')\r\n        : vars.length + '-variables') +\r\n      '_' +\r\n      (rows.join('\\n').split('\\n').length - 1) +\r\n      'x' +\r\n      rows[0].split(sep).length\r\n  if (in_browser) {\r\n    const e = document.createElement('a')\r\n    document.body.appendChild(e)\r\n    e.rel = 'noreferrer'\r\n    e.target = '_blank'\r\n    e.download = filename + '.' + query.file_format\r\n    e.href = URL.createObjectURL(new Blob([res.body], {type: res.headers['Content-Type']}))\r\n    setTimeout(function () {\r\n      e.dispatchEvent(new MouseEvent('click'))\r\n      URL.revokeObjectURL.bind(null, e.href)\r\n      document.body.removeChild(e)\r\n    }, 0)\r\n  }\r\n  res.statusCode = 200\r\n  res.headers['Content-Disposition'] += filename + '.' + query.file_format\r\n  return res\r\n}\r\n","import {Entity} from '../types'\r\n\r\nexport function single(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) && t < this.time.value.length ? this.time.value[t] : NaN\r\n  } else {\r\n    v = this.variables[v].code\r\n    return 0 === t && v in this.data ? this.data[v] : NaN\r\n  }\r\n}\r\n\r\nexport function multi(this: Entity, v: string, t: number) {\r\n  if (t < 0) return NaN\r\n  if (this.variables[v].is_time) {\r\n    return Array.isArray(this.time.value) ? this.time.value[t] : this.time.value\r\n  } else {\r\n    v = this.variables[v].code\r\n    const value = this.data[v]\r\n    return v in this.data ? (Array.isArray(value) ? (t < value.length ? value[t] : NaN) : 0 === t ? value : NaN) : NaN\r\n  }\r\n}\r\n\r\nexport function row_time(\r\n  this: {i: number; o: number; format_value: Function},\r\n  d: number[],\r\n  type: string,\r\n  row: {offset: number; int: boolean}\r\n) {\r\n  const i = this.i - (row.offset - this.o)\r\n  return d && i >= 0 && i < d.length ? ('number' === typeof d[i] ? this.format_value(d[i], row.int) : d[i]) : NaN\r\n}\r\n","import DataHandler from '.'\r\nimport {Settings} from '../types'\r\nimport {patterns} from './patterns'\r\n\r\nexport function value(this: {settings: Settings}, v: null | number, int: boolean): number | string {\r\n  if (null === v || isNaN(v)) {\r\n    return NaN\r\n  } else if (int) {\r\n    return v\r\n  } else {\r\n    return 'string' === typeof this.settings.settings.digits\r\n      ? v\r\n      : v.toFixed(this.settings.settings.digits > 0 ? this.settings.settings.digits : 0)\r\n  }\r\n}\r\n\r\nexport function label(this: DataHandler, l: string): string {\r\n  return 'string' !== typeof l\r\n    ? ''\r\n    : l in this.variables && this.variables[l].meta && this.variables[l].meta.short_name\r\n    ? this.variables[l].meta.short_name\r\n    : l.replace(patterns.seps, ' ').replace(patterns.word_start, function (w) {\r\n        return w.toUpperCase()\r\n      })\r\n}\r\n","import DataHandler from '.'\r\nimport type {Data, EntityFeatureSet, EntityFeatures, IdMap} from '../types'\r\n\r\nexport function data(this: DataHandler, d: Data, name: string) {\r\n  this.sets[name] = d\r\n  this.loaded[name] = true\r\n  if (!(name in this.info)) this.info[name] = {name: name, site_file: name + '.json', schema: {fields: []}, ids: []}\r\n  if ('_meta' in d) {\r\n    const time = d._meta.time\r\n    this.meta.times[name] = time\r\n    if ('number' === typeof time.value) time.value = [time.value as number]\r\n    const times = time.value as number[]\r\n    time.n = times.length\r\n    time.is_single = 1 === time.n\r\n    time.range = [times[0], times[time.n - 1]]\r\n    if (d._meta.time.name in this.variables) {\r\n      time.info = this.variables[time.name]\r\n      time.info.is_time = true\r\n    }\r\n    if (time.range[0] < this.meta.overall.range[0]) this.meta.overall.range[0] = time.range[0]\r\n    if (time.range[1] > this.meta.overall.range[1]) this.meta.overall.range[1] = time.range[1]\r\n    times.forEach((v: number) => {\r\n      if (-1 === this.meta.overall.value.indexOf(v)) this.meta.overall.value.push(v)\r\n    })\r\n    this.meta.overall.value.sort()\r\n    this.meta.variables[name] = d._meta.variables || {}\r\n    Object.keys(this.meta.variables[name]).forEach((k: string) => {\r\n      if (!(k in this.variables)) {\r\n        this.variables[k] = {\r\n          datasets: [name],\r\n          info: {},\r\n          time_range: {},\r\n          type: 'unknown',\r\n          name: k,\r\n          code: k,\r\n          views: {},\r\n          meta: {\r\n            full_name: k,\r\n            measure: k.split(':')[1] || k,\r\n            short_name: this.format_label(k),\r\n            long_name: k,\r\n            type: 'unknown',\r\n          },\r\n        }\r\n        this.variable_info[k] = this.variables[k].meta\r\n      }\r\n      this.variables[k].name = k\r\n      this.variables[k].code = this.meta.variables[name][k].code\r\n      const t = this.meta.variables[name][k].time_range\r\n      this.variables[k].time_range[name] = t\r\n      this.variable_codes[this.variables[k].code] = this.variables[k]\r\n      if (-1 !== t[0]) {\r\n        if (k in this.meta.ranges) {\r\n          if (t[0] < this.meta.ranges[k][0]) this.meta.ranges[k][0] = t[0]\r\n          if (t[1] > this.meta.ranges[k][1]) this.meta.ranges[k][1] = t[1]\r\n        } else {\r\n          this.meta.ranges[k] = [t[0], t[1]]\r\n        }\r\n      }\r\n    })\r\n  }\r\n  this.load_id_maps()\r\n}\r\n\r\nexport async function id_maps(this: DataHandler) {\r\n  this.metadata.datasets &&\r\n    this.metadata.datasets.forEach((k: string) => {\r\n      let has_map = false\r\n      this.info[k].ids.forEach((id: IdMap, i: number) => {\r\n        if ('map' in id) {\r\n          has_map = true\r\n          const map = id.map\r\n          if (map in this.data_maps) {\r\n            if (this.data_maps[map].retrieved) {\r\n              const features = (\r\n                k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n              ) as EntityFeatures\r\n              this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n              this.map_entities(k)\r\n            } else {\r\n              const queue = this.data_maps[map].queue as string[]\r\n              if (-1 === queue.indexOf(k)) queue.push(k)\r\n            }\r\n          } else if ('string' !== typeof map || id.map_content) {\r\n            if ('string' === typeof map) {\r\n              this.data_maps[map] = {queue: [], resource: JSON.parse(id.map_content), retrieved: true}\r\n              const features = (\r\n                k in this.data_maps[map].resource ? this.data_maps[map].resource[k] : this.data_maps[map].resource\r\n              ) as EntityFeatures\r\n              this.info[k].schema.fields[i].ids = this.entity_features[k] = features\r\n            } else {\r\n              this.entity_features[k] = map\r\n            }\r\n            this.map_entities(k)\r\n          } else {\r\n            this.data_maps[map] = {queue: [k], resource: {}, retrieved: false}\r\n            if (this.settings.entity_info && map in this.settings.entity_info) {\r\n              const e = this.settings.entity_info\r\n              if ('string' === typeof e[map]) e[map] = JSON.parse(e[map] as string)\r\n              this.ingest_map(e[map] as EntityFeatures, map, i)\r\n            } else if ('undefined' === typeof window) {\r\n              require('https')\r\n                .get(map, (r: {req: {protocol: string; host: string; path: string}; on: Function}) => {\r\n                  const c: string[] = []\r\n                  r.on('data', (d: string) => {\r\n                    c.push(d)\r\n                  })\r\n                  r.on('end', () => {\r\n                    this.ingest_map(JSON.parse(c.join('')), r.req.protocol + '//' + r.req.host + r.req.path, i)\r\n                  })\r\n                })\r\n                .end()\r\n            } else {\r\n              const f = new window.XMLHttpRequest()\r\n              f.onreadystatechange = function (this: DataHandler, url: string, fi: number) {\r\n                if (4 === f.readyState) {\r\n                  if (200 === f.status) {\r\n                    this.ingest_map(JSON.parse(f.responseText), url, fi)\r\n                  } else {\r\n                    throw new Error('data_handler.ingester.id_maps failed: ' + f.responseText)\r\n                  }\r\n                }\r\n              }.bind(this, map, i)\r\n              f.open('GET', map, true)\r\n              f.send()\r\n            }\r\n          }\r\n        }\r\n      })\r\n      if (!has_map) {\r\n        this.entity_features[k] = {}\r\n        this.map_entities(k)\r\n      }\r\n    })\r\n}\r\n\r\nexport function map(this: DataHandler, m: EntityFeatures | EntityFeatureSet, url: string, field: number) {\r\n  this.data_maps[url].resource = m\r\n  this.data_maps[url].retrieved = true\r\n  this.data_maps[url].queue.forEach((k: string) => {\r\n    if (this.info[k].schema.fields.length > field) {\r\n      if (!(k in this.entity_features)) this.entity_features[k] = {}\r\n      const features = (\r\n        k in this.data_maps[url].resource ? this.data_maps[url].resource[k] : this.data_maps[url].resource\r\n      ) as EntityFeatures\r\n      this.info[k].schema.fields[field].ids = this.entity_features[k] = features\r\n      this.map_entities(k)\r\n    }\r\n  })\r\n  this.hooks.data_load && this.hooks.data_load()\r\n}\r\n","import DataHandler from '.'\r\nimport type {Order, Data, Variable, VariableView, EntityData, Summary, MeasureInfo} from '../types'\r\n\r\nfunction sort_a1(a: [string, number], b: [string, number]): number {\r\n  return isNaN(a[1]) ? (isNaN(b[1]) ? 0 : -1) : isNaN(b[1]) ? 1 : a[1] - b[1]\r\n}\r\n\r\nfunction summary_template(): Summary {\r\n  return {\r\n    type: 'number',\r\n    filled: false,\r\n    missing: [],\r\n    n: [],\r\n    sum: [],\r\n    max: [],\r\n    q3: [],\r\n    mean: [],\r\n    range: [],\r\n    norm_median: [],\r\n    break_median: [],\r\n    lower_median_min: [],\r\n    lower_median_range: [],\r\n    upper_median_min: [],\r\n    upper_median_range: [],\r\n    norm_mean: [],\r\n    break_mean: [],\r\n    lower_mean_min: [],\r\n    lower_mean_range: [],\r\n    upper_mean_min: [],\r\n    upper_mean_range: [],\r\n    median: [],\r\n    q1: [],\r\n    min: [],\r\n    mode: [],\r\n    level_ids: {},\r\n    levels: [],\r\n  }\r\n}\r\n\r\nexport function init(this: DataHandler, v: string, d: string) {\r\n  if (!this.inited_summary[d + v]) {\r\n    ;(this.in_browser ? Object.keys(this.settings.dataviews) : ['default_view']).forEach((view: string) => {\r\n      const vi: Variable = this.variables[v]\r\n      if (!(view in vi.views))\r\n        vi.views[view] = {\r\n          order: {},\r\n          selected_order: {},\r\n          selected_summaries: {},\r\n          summaries: {},\r\n          state: {},\r\n          table: {},\r\n        }\r\n      if (!(d in vi.time_range)) {\r\n        vi.time_range[d] = [0, this.meta.times[d].n - 1]\r\n      }\r\n      const ny = (vi.time_range[d][2] = vi.time_range[d][1] - vi.time_range[d][0] + 1)\r\n      const m: VariableView = vi.views[view],\r\n        c = vi.code\r\n      if (d in this.sets) {\r\n        const da: Data = this.sets[d]\r\n        const n: number = this.info[d].entity_count\r\n        const at = !n || n > 65535 ? Uint32Array : n > 255 ? Uint16Array : Uint8Array\r\n        const info = vi.info[d]\r\n        const is_string = 'string' === info.type\r\n        let o = info.order\r\n        if (o) {\r\n          Object.keys(da).forEach((k: string) => {\r\n            if (!(k in this.entities)) return\r\n            if (!(view in this.entities[k].views))\r\n              this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n            this.entities[k].views[view].rank[v] = new at(ny)\r\n            this.entities[k].views[view].subset_rank[v] = new at(ny)\r\n          })\r\n        } else {\r\n          info.order = o = []\r\n          for (let y = ny; y--; ) {\r\n            o.push([])\r\n          }\r\n          Object.keys(da).forEach((k: string) => {\r\n            const dak = da[k] as EntityData\r\n            if ('_meta' !== k && c in dak) {\r\n              const ev: number | number[] = dak[c]\r\n              if (Array.isArray(ev)) {\r\n                for (let y = ny; y--; ) {\r\n                  if (is_string && ev[y] in vi.level_ids) {\r\n                    ev[y] = vi.level_ids[ev[y]]\r\n                  } else if ('number' !== typeof ev[y]) ev[y] = NaN\r\n                  o[y].push([k, ev[y]])\r\n                }\r\n                Object.freeze(ev)\r\n              } else {\r\n                if (is_string && ev in vi.level_ids) {\r\n                  o[0].push([k, vi.level_ids[ev]])\r\n                } else if ('number' !== typeof ev) {\r\n                  dak[c] = NaN\r\n                  o[0].push([k, NaN])\r\n                } else o[0].push([k, ev])\r\n              }\r\n              if (!(k in this.entities)) return\r\n              if (!(view in this.entities[k].views))\r\n                this.entities[k].views[view] = {summary: {}, rank: {}, subset_rank: {}}\r\n              const eview = this.entities[k].views[view]\r\n              if (!(v in eview.rank)) {\r\n                eview.rank[v] = new at(ny)\r\n                eview.subset_rank[v] = new at(ny)\r\n              }\r\n            }\r\n          })\r\n        }\r\n        o.forEach((ev: Order, y: number) => {\r\n          if (!Object.isFrozen(ev)) {\r\n            ev.sort(sort_a1)\r\n            Object.freeze(ev)\r\n          }\r\n          ev.forEach((r, i) => {\r\n            this.entities[r[0]].views[view].rank[v][y] = i\r\n          })\r\n        })\r\n      }\r\n      if (!(d in m.summaries)) {\r\n        m.order[d] = []\r\n        m.selected_order[d] = []\r\n        m.selected_summaries[d] = summary_template()\r\n        const s = summary_template()\r\n        if ('string' === vi.info[d as keyof MeasureInfo].type) {\r\n          s.type = 'string'\r\n          s.level_ids = vi.level_ids\r\n          s.levels = vi.levels\r\n          m.table = {}\r\n          vi.levels.forEach((l: string) => {\r\n            m.table[l] = []\r\n            for (let y = ny; y--; ) m.table[l].push(0)\r\n          })\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.mode.push('')\r\n          }\r\n          m.summaries[d] = s\r\n        } else {\r\n          for (let y = ny; y--; ) {\r\n            m.order[d].push([])\r\n            m.selected_order[d].push([])\r\n            m.selected_summaries[d].n.push(0)\r\n            m.selected_summaries[d].missing.push(0)\r\n            s.missing.push(0)\r\n            s.n.push(0)\r\n            s.sum.push(0)\r\n            s.max.push(-Infinity)\r\n            s.q3.push(0)\r\n            s.mean.push(0)\r\n            s.norm_median.push(0)\r\n            s.break_median.push(-1)\r\n            s.lower_median_min.push(-1)\r\n            s.lower_median_range.push(-1)\r\n            s.upper_median_min.push(-1)\r\n            s.upper_median_range.push(-1)\r\n            s.norm_mean.push(0)\r\n            s.break_mean.push(-1)\r\n            s.lower_mean_min.push(-1)\r\n            s.lower_mean_range.push(-1)\r\n            s.upper_mean_min.push(-1)\r\n            s.upper_mean_range.push(-1)\r\n            s.median.push(0)\r\n            s.q1.push(0)\r\n            s.min.push(Infinity)\r\n          }\r\n          m.summaries[d] = s\r\n        }\r\n        Object.seal(m.order[d])\r\n        Object.seal(m.selected_order[d])\r\n        Object.seal(m.selected_summaries[d])\r\n        Object.seal(m.summaries[d])\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction quantile(p: number, n: number, o: number, x: Order): number {\r\n  const a = p * (n - 1),\r\n    ap = a % 1,\r\n    bp = 1 - ap,\r\n    b = o + Math.ceil(a),\r\n    i = o + Math.floor(a)\r\n  return x[i][1] * ap + x[b][1] * bp\r\n}\r\n\r\nexport async function calculate(this: DataHandler, measure: string, view: string, full: boolean): Promise<void> {\r\n  const v = this.settings.dataviews[view]\r\n  const dataset: string = v.get.dataset()\r\n  await this.data_processed[dataset]\r\n  const summaryId = dataset + measure\r\n  if (!this.inited_summary[summaryId]) this.init_summary(measure, dataset)\r\n  this.inited_summary[summaryId] = new Promise(resolve => {\r\n    this.summary_ready[summaryId] = resolve\r\n  })\r\n  const variable = this.variables[measure],\r\n    m = variable.views[view]\r\n  if (m.state[dataset] !== v.state) {\r\n    const s = v.selection[this.settings.settings.summary_selection],\r\n      a = v.selection.all,\r\n      mo = m.order[dataset],\r\n      mso = m.selected_order[dataset],\r\n      ny = variable.time_range[dataset][2],\r\n      order = variable.info[dataset].order,\r\n      levels = variable.levels,\r\n      level_ids = variable.level_ids,\r\n      subset = v.n_selected[this.settings.settings.summary_selection] !== v.n_selected.dataset,\r\n      mss = m.selected_summaries[dataset],\r\n      ms = m.summaries[dataset],\r\n      is_string = 'string' === variable.type\r\n    for (let y = ny; y--; ) {\r\n      mo[y] = subset ? [] : order[y]\r\n      mso[y] = subset ? [] : order[y]\r\n      mss.missing[y] = 0\r\n      mss.n[y] = 0\r\n      ms.missing[y] = 0\r\n      ms.n[y] = 0\r\n      if (is_string) {\r\n        ms.mode[y] = ''\r\n        levels.forEach(k => (m.table[k][y] = 0))\r\n      } else {\r\n        ms.sum[y] = 0\r\n        ms.mean[y] = 0\r\n        ms.max[y] = -Infinity\r\n        ms.min[y] = Infinity\r\n        ms.break_mean[y] = -1\r\n        ms.break_median[y] = -1\r\n      }\r\n    }\r\n    order.forEach((o, y) => {\r\n      const moy = mo[y],\r\n        msoy = mso[y]\r\n      let rank = 0\r\n      o.forEach(oi => {\r\n        const k = oi[0],\r\n          value = oi[1]\r\n        if (k in s) {\r\n          const en = s[k].views[view],\r\n            present = !isNaN(value)\r\n          if (!y) {\r\n            if (!(measure in en.summary)) en.summary[measure] = {n: 0, overall: ms, order: mo}\r\n            en.summary[measure].n = 0\r\n          }\r\n          if (full && subset) {\r\n            moy.push(oi)\r\n            if (k in a) {\r\n              msoy.push(oi)\r\n              if (present) {\r\n                mss.n[y]++\r\n              } else mss.missing[y]++\r\n            }\r\n          }\r\n          if (present) {\r\n            en.subset_rank[measure][y] = rank++\r\n            en.summary[measure].n++\r\n            ms.n[y]++\r\n            if (is_string) {\r\n              m.table[levels[value]][y]++\r\n            } else {\r\n              ms.sum[y] += value\r\n              if (value > ms.max[y]) ms.max[y] = value\r\n              if (value < ms.min[y]) ms.min[y] = value\r\n            }\r\n          } else ms.missing[y]++\r\n        }\r\n      })\r\n    })\r\n    if (full) {\r\n      mo.forEach((o, y) => {\r\n        if (is_string) {\r\n          if (ms.n[y]) {\r\n            let l = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[l]][y]) l = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[l]\r\n          } else ms.mode[y] = ''\r\n        } else {\r\n          if (ms.n[y]) {\r\n            ms.mean[y] = ms.sum[y] / ms.n[y]\r\n            if (!isFinite(ms.min[y])) ms.min[y] = ms.mean[y]\r\n            if (!isFinite(ms.max[y])) ms.max[y] = ms.mean[y]\r\n            ms.range[y] = ms.max[y] - ms.min[y]\r\n            if (1 === ms.n[y]) {\r\n              ms.q3[y] = ms.median[y] = ms.q1[y] = null == o[0][1] ? ms.mean[y] : o[0][1]\r\n            } else {\r\n              ms.median[y] = quantile(0.5, ms.n[y], ms.missing[y], o)\r\n              ms.q3[y] = quantile(0.75, ms.n[y], ms.missing[y], o)\r\n              ms.q1[y] = quantile(0.25, ms.n[y], ms.missing[y], o)\r\n            }\r\n            const n = o.length\r\n            for (let i = ms.missing[y], bmd = false, bme = false; i < n; i++) {\r\n              const v = o[i][1]\r\n              if ('number' === typeof v) {\r\n                if (!bmd && v > ms.median[y]) {\r\n                  ms.break_median[y] = i - 1\r\n                  bmd = true\r\n                }\r\n                if (!bme && v > ms.mean[y]) {\r\n                  ms.break_mean[y] = i - 1\r\n                  bme = true\r\n                }\r\n              }\r\n              if (bmd && bme) break\r\n            }\r\n          } else {\r\n            ms.max[y] = 0\r\n            ms.q3[y] = 0\r\n            ms.median[y] = 0\r\n            ms.q1[y] = 0\r\n            ms.min[y] = 0\r\n          }\r\n          if (ms.n[y]) {\r\n            ms.norm_median[y] = ms.range[y] ? (ms.median[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_median[y]) {\r\n              ms.lower_median_min[y] = ms.norm_median[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_median_range[y] =\r\n                ms.norm_median[y] - ((o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_median_min[y])\r\n              ms.upper_median_min[y] = ms.norm_median[y] - (o[ms.break_median[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_median_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_median[y] - ms.upper_median_min[y]\r\n            }\r\n            ms.norm_mean[y] = ms.range[y] ? (ms.mean[y] - ms.min[y]) / ms.range[y] : 0.5\r\n            if (-1 !== ms.break_mean[y]) {\r\n              ms.lower_mean_min[y] = ms.norm_mean[y] - (o[ms.missing[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.lower_mean_range[y] =\r\n                ms.norm_mean[y] - ((o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y] - ms.lower_mean_min[y])\r\n              ms.upper_mean_min[y] = ms.norm_mean[y] - (o[ms.break_mean[y]][1] - ms.min[y]) / ms.range[y]\r\n              ms.upper_mean_range[y] =\r\n                (o[o.length - 1][1] - ms.min[y]) / ms.range[y] - ms.norm_mean[y] - ms.upper_mean_min[y]\r\n            }\r\n          }\r\n        }\r\n      })\r\n    } else {\r\n      for (let y = 0; y < ny; y++) {\r\n        if (ms.n[y]) {\r\n          if (is_string) {\r\n            let q1 = 0\r\n            Object.keys(m.table).forEach(k => {\r\n              if (m.table[k][y] > m.table[levels[q1]][y]) q1 = level_ids[k]\r\n            })\r\n            ms.mode[y] = levels[q1]\r\n          } else ms.mean[y] = ms.sum[y] / ms.n[y]\r\n        } else {\r\n          ms[is_string ? 'mode' : 'mean'][y] = NaN\r\n        }\r\n      }\r\n    }\r\n    ms.filled = true\r\n    m.state[dataset] = v.state\r\n    this.summary_ready[summaryId]()\r\n  } else await this.summary_ready[summaryId]\r\n}\r\n","import DataHandler from '.'\r\nimport type {Entity, EntityData, IdMap, ResourceField, UnparsedObject, Variable} from '../types'\r\n\r\nexport function variables(this: DataHandler) {\r\n  this.metadata.datasets.forEach((k: string) => {\r\n    this.data_queue[k] = {}\r\n    const m = this.info[k]\r\n    if (m) {\r\n      m.id_vars = m.ids.map((id: IdMap) => id.variable)\r\n      m.schema.fields.forEach((v: ResourceField) => {\r\n        const vn = v.name\r\n        if (vn in this.variables) {\r\n          const ve = this.variables[vn]\r\n          ve.datasets.push(k)\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            ;((v.info && v.info.levels) || Object.keys(v.table)).forEach(l => {\r\n              if (!(l in ve.level_ids)) {\r\n                ve.level_ids[l] = ve.levels.length\r\n                ve.levels.push(l)\r\n              }\r\n            })\r\n          }\r\n        } else {\r\n          const ve: Variable = (this.variables[vn] = {\r\n            datasets: [k],\r\n            info: {full_name: k, type: 'unknown'} as UnparsedObject,\r\n            time_range: {},\r\n            type: v.type,\r\n            code: k,\r\n            name: k,\r\n            meta: v.info,\r\n            levels: [],\r\n            level_ids: {},\r\n            table: {},\r\n            order: [],\r\n            views: {},\r\n          })\r\n          ve.info[k] = v\r\n          if ('string' === v.type) {\r\n            ve.levels = []\r\n            ve.level_ids = {}\r\n            ;(v.info.levels || Object.keys(v.table)).forEach(l => {\r\n              ve.level_ids[l] = ve.levels.length\r\n              ve.levels.push(l)\r\n            })\r\n          }\r\n          if (!ve.meta)\r\n            ve.meta = {\r\n              full_name: vn,\r\n              measure: vn.split(':')[1] || vn,\r\n              short_name: this.format_label(vn),\r\n              type: 'integer',\r\n            }\r\n          ve.meta.full_name = vn\r\n          if (!('measure' in ve.meta)) ve.meta.measure = vn.split(':')[1] || vn\r\n          if (!('short_name' in ve.meta)) ve.meta.short_name = this.format_label(vn)\r\n          if (!('long_name' in ve.meta)) ve.meta.long_name = ve.meta.short_name\r\n          if (!(vn in this.variable_info)) this.variable_info[vn] = ve.meta\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nexport async function entities(this: DataHandler, g: string): Promise<void> {\r\n  if (g in this.sets && !this.inited[g] && g in this.meta.times) {\r\n    const s = this.sets[g],\r\n      time = this.meta.times[g],\r\n      retriever = DataHandler.retrievers[time.is_single ? 'single' : 'multi'],\r\n      datasets = Object.keys(this.sets),\r\n      infos = this.info\r\n    Object.keys(s).forEach((id: string) => {\r\n      const si = s[id] as EntityData,\r\n        l = id.length\r\n      if ('_meta' !== id) {\r\n        const overwrite = this.entity_features[g][id]\r\n        const f = overwrite || {id: id, name: id}\r\n        f.id = id\r\n        if (!f.name) f.name = id\r\n        const e = (\r\n          id in this.entities\r\n            ? this.entities[id]\r\n            : {\r\n                group: g,\r\n                data: si,\r\n                variables: this.variables,\r\n                features: f,\r\n                views: {},\r\n              }\r\n        ) as Entity\r\n        if (id in this.entities) {\r\n          e.group = g\r\n          e.data = si\r\n          e.variables = this.variables\r\n          if (!e.features) e.features = {}\r\n        } else {\r\n          this.entities[id] = e\r\n        }\r\n        if (!(id in this.entity_tree)) this.entity_tree[id] = {parents: {}, children: {}}\r\n        const rel = this.entity_tree[id]\r\n        e.relations = rel\r\n        Object.keys(f).forEach((k: string) => {\r\n          if (!(k in this.features)) this.features[k] = this.format_label(k)\r\n          if ('id' === k || overwrite || !(k in e.features)) {\r\n            e.features[k] = f[k]\r\n          }\r\n          if (-1 !== this.metadata.datasets.indexOf(k)) {\r\n            if (!(f[k] in this.entity_tree)) this.entity_tree[f[k]] = {parents: {}, children: {}}\r\n            this.entity_tree[f[k]].children[id] = rel\r\n            rel.parents[f[k]] = this.entity_tree[f[k]]\r\n          }\r\n        })\r\n        if (infos) {\r\n          datasets.forEach((d: string) => {\r\n            const p = infos[d].id_length\r\n            if (p && p < l) {\r\n              const sl = id.substring(0, p)\r\n              if (sl in this.sets[d]) {\r\n                if (!(sl in this.entity_tree)) this.entity_tree[sl] = {parents: {}, children: {}}\r\n                this.entity_tree[sl].children[id] = rel\r\n                rel.parents[sl] = this.entity_tree[sl]\r\n              }\r\n            }\r\n          })\r\n        }\r\n        ;(this.in_browser ? Object.keys(this.settings.dataviews) : ['default_view']).forEach((v: string) => {\r\n          if (!(v in e.views)) {\r\n            e.views[v] = {summary: {}, rank: {}, subset_rank: {}}\r\n          }\r\n        })\r\n        e.time = time\r\n        e.get_value = retriever.bind(e)\r\n      }\r\n    })\r\n    this.inited[g] = true\r\n    this.data_promise[g]()\r\n    setTimeout(() => {\r\n      if (!this.inited.first) {\r\n        this.hooks.init && this.hooks.init()\r\n        this.inited.first = true\r\n      }\r\n      g in this.data_queue &&\r\n        Object.keys(this.data_queue[g]).forEach((id: string) => {\r\n          this.data_queue[g][id]()\r\n          delete this.data_queue[g][id]\r\n        })\r\n      this.hooks.onload && this.hooks.onload(g)\r\n    }, 0)\r\n  }\r\n  for (const k in this.info) if (Object.prototype.hasOwnProperty.call(this.info, k) && !this.inited[k]) return void 0\r\n  this.all_data_ready()\r\n}\r\n","import {patterns} from './patterns'\r\nimport {Filter, Query, UnparsedObject} from '../types'\r\nimport * as params from './export_params'\r\nimport {group_checks} from './checks'\r\nimport DataHandler from '.'\r\n\r\nexport function query(this: DataHandler, q: any): Query {\r\n  const f: UnparsedObject = JSON.parse(JSON.stringify(params.defaults))\r\n  if ('string' === typeof q) {\r\n    if ('?' === q[0]) q = q.substring(1)\r\n    const aq: string[] = q.split('&')\r\n    q = {}\r\n    aq.forEach(aqi => {\r\n      const a = aqi.split('=')\r\n      q[a[0]] = a.length > 1 ? a[1] : ''\r\n    })\r\n  }\r\n  q &&\r\n    Object.keys(q).forEach(k => {\r\n      if ('include' === k || 'exclude' === k || k in f) {\r\n        f[k] = q[k]\r\n      } else {\r\n        let a: string[] = []\r\n        if (patterns.single_operator.test(k)) {\r\n          a = k.replace(patterns.single_operator, '$1=$2').split('=')\r\n          if (a.length > 1) {\r\n            k = a[0]\r\n            q[k] = a[1]\r\n          }\r\n        }\r\n        const aq = patterns.component.exec(k),\r\n          tf: Filter = {\r\n            name: k.replace(patterns.greater, '>').replace(patterns.less, '<'),\r\n            component: 'mean',\r\n            operator: '=',\r\n            value: patterns.number.test(q[k]) ? Number(q[k]) : q[k],\r\n            time_component: false,\r\n            check: () => false,\r\n          }\r\n        if ('object' === typeof q[k]) {\r\n          if ('component' in q[k]) tf.component = q[k].component\r\n          if ('operator' in q[k]) tf.operator = q[k].operator\r\n          if ('value' in q[k]) tf.value = q[k].value\r\n        }\r\n        k = tf.name\r\n        if (aq) {\r\n          if (-1 !== params.options.filter_components.indexOf(aq[2])) {\r\n            tf.component = aq[2]\r\n            tf.name = aq[1]\r\n          } else if (patterns.number.test(aq[2])) {\r\n            const time = Number(aq[2])\r\n            const i = time > 0 && time < this.meta.overall.value.length ? time : this.meta.overall.value.indexOf(time)\r\n            if (-1 !== i) {\r\n              tf.time_component = true\r\n              tf.component = i\r\n              tf.name = aq[1]\r\n            }\r\n          }\r\n        }\r\n        if (patterns.operator_start.test(k) && k[k.length - 1] in DataHandler.checks) {\r\n          tf.operator = k[k.length - 1]\r\n          if (!a.length) tf.operator += '='\r\n          if (k === tf.name) tf.name = k.substring(0, k.length - 1)\r\n        }\r\n        if (undefined === tf.value || '-1' == tf.value) return\r\n        if (\r\n          ('=' === tf.operator || '!' === tf.operator) &&\r\n          'string' === typeof tf.value &&\r\n          patterns.comma.test(tf.value)\r\n        ) {\r\n          tf.value = tf.value.split(',')\r\n          tf.operator = '=' === tf.operator ? 'includes' : 'excludes'\r\n        }\r\n        if ('time_range' === tf.name) {\r\n          if (Array.isArray(tf.value)) {\r\n            f.time_range = [\r\n              this.meta.overall.value.indexOf(Number(tf.value[0])),\r\n              this.meta.overall.value.indexOf(Number(tf.value[1])),\r\n            ]\r\n          } else {\r\n            const i = this.meta.overall.value.indexOf(Number(tf.value))\r\n            f.time_range =\r\n              '=' === tf.operator ? [i, i] : '>' === tf.operator ? [i, this.meta.overall.value.length - 1] : [0, i]\r\n          }\r\n          if (-1 === f.time_range[0]) f.time_range[0] = 0\r\n          if (-1 === f.time_range[1])\r\n            f.time_range[1] = this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0\r\n        } else if ('dataset' === tf.name) {\r\n          f.dataset = tf\r\n        } else if (tf.name in this.features) {\r\n          if ('id' === tf.name && !tf.value) tf.value = String(tf.value).split(',')\r\n          tf.check = group_checks[tf.operator].bind(tf.value || tf.value)\r\n          f.feature_conditions.push(tf)\r\n        } else if (tf.name in this.variables) {\r\n          tf.check = (\r\n            tf.time_component\r\n              ? function (this: {check: Function; condition: Filter}, d: number | number[], adj: number) {\r\n                  const multi = 'number' !== typeof d,\r\n                    i = 'number' === typeof this.condition.component ? this.condition.component - adj : 0\r\n                  return multi\r\n                    ? this.check(d[i], this.condition.value)\r\n                    : !i\r\n                    ? this.check(d, this.condition.value)\r\n                    : false\r\n                }\r\n              : function (this: {check: Function; condition: Filter}, s: {[index: string]: string}) {\r\n                  return this.check(s[this.condition.component], this.condition.value)\r\n                }\r\n          ).bind({check: DataHandler.checks[tf.operator], condition: tf})\r\n          if (-1 === f.variables.filter_by.indexOf(tf.name)) f.variables.filter_by.push(tf.name)\r\n          f.variables.conditions.push(tf)\r\n        }\r\n      }\r\n    })\r\n  if (!('time_range' in f)) f.time_range = [0, this.meta.overall.value.length ? this.meta.overall.value.length - 1 : 0]\r\n  return f as Query\r\n}\r\n","'use strict'\r\nimport {value_checks} from './checks'\r\nimport {exporter} from './exporter'\r\nimport * as retrievers from './retrievers'\r\nimport * as formatter from './formatters'\r\nimport * as ingester from './ingesters'\r\nimport * as summary from './summary'\r\nimport * as mapper from './mappers'\r\nimport * as parser from './parsers'\r\nimport type {\r\n  Settings,\r\n  Variable,\r\n  Metadata,\r\n  MeasureInfos,\r\n  DataSets,\r\n  Features,\r\n  Variables,\r\n  References,\r\n  Entities,\r\n  Relations,\r\n  MetaTime,\r\n  LogicalObject,\r\n  Promises,\r\n  DataMaps,\r\n  DataResource,\r\n  MeasureInfo,\r\n  DataPackage,\r\n  EntityFeatureSet,\r\n  Entity,\r\n} from '../types'\r\n\r\nexport default class DataHandler {\r\n  constructor(\r\n    settings?: Settings,\r\n    defaults?: {[index: string]: string},\r\n    data?: DataSets,\r\n    hooks?: {[index: string]: Function}\r\n  ) {\r\n    if (hooks) this.hooks = hooks\r\n    if (defaults) this.defaults = defaults\r\n    if (settings) this.settings = settings\r\n    if (this.settings.metadata) this.metadata = this.settings.metadata\r\n    if (data) this.sets = data\r\n    this.get_value = this.get_value.bind(this)\r\n    this.in_browser = 'undefined' !== typeof Window\r\n    if ('string' === typeof this.metadata.datasets) this.metadata.datasets = [this.metadata.datasets]\r\n    const init = () => {\r\n      if (!this.metadata.datasets) this.metadata.datasets = Object.keys(this.info)\r\n      if (this.metadata.measure_info) {\r\n        const info = this.metadata.measure_info\r\n        this.metadata.datasets.forEach((d: string) => {\r\n          if (info._references) this.info[d]._references = info._references\r\n          const v = this.info[d].schema.fields\r\n          v.forEach(e => (e.name in info ? (e.info = info[e.name] as MeasureInfo) : ''))\r\n        })\r\n      }\r\n      this.map_variables()\r\n      this.metadata.datasets.forEach((k: string) => {\r\n        this.loaded[k] = k in this.sets\r\n        this.inited[k] = false\r\n        this.data_processed[k] = new Promise(resolve => {\r\n          this.data_promise[k] = resolve\r\n        })\r\n        if (k in this.info)\r\n          this.info[k].site_file = (this.metadata.url ? this.metadata.url + '/' : '') + this.info[k].name + '.json'\r\n        if (this.loaded[k]) {\r\n          this.ingest_data(this.sets[k], k)\r\n        } else if (\r\n          !this.in_browser ||\r\n          (this.settings.settings && !this.settings.settings.partial_init) ||\r\n          !this.defaults.dataset ||\r\n          k === this.defaults.dataset\r\n        )\r\n          this.retrieve(k, this.info[k].site_file)\r\n      })\r\n    }\r\n    if (this.metadata.package && !this.metadata.info) {\r\n      if ('undefined' === typeof window) {\r\n        require('https')\r\n          .get(this.metadata.url + this.metadata.package, (r: {on: Function}) => {\r\n            const c: string[] = []\r\n            r.on('data', (d: string) => {\r\n              c.push(d)\r\n            })\r\n            r.on('end', () => {\r\n              this.info = {}\r\n              const dp: DataPackage = JSON.parse(c.join(''))\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            })\r\n          })\r\n          .end()\r\n      } else {\r\n        const f = new window.XMLHttpRequest()\r\n        f.onreadystatechange = () => {\r\n          if (4 === f.readyState) {\r\n            if (200 === f.status) {\r\n              this.info = {}\r\n              const dp = JSON.parse(f.responseText)\r\n              if (dp.measure_info) this.metadata.measure_info = dp.measure_info\r\n              dp.resources.forEach((r: DataResource) => (this.info[r.name] = r))\r\n              init()\r\n            } else {\r\n              throw new Error('failed to load datapackage: ' + f.responseText)\r\n            }\r\n          }\r\n        }\r\n        f.open('GET', this.metadata.url + this.metadata.package)\r\n        f.send()\r\n      }\r\n    } else {\r\n      if (this.metadata.info) this.info = this.metadata.info\r\n      init()\r\n    }\r\n  }\r\n  hooks: {[index: string]: Function} = {}\r\n  defaults: {[index: string]: string} = {dataview: 'default_view', time: 'time'}\r\n  settings: Settings = {}\r\n  metadata: Metadata = {datasets: []}\r\n  info: {[index: string]: DataResource} = {}\r\n  sets: DataSets = {}\r\n  in_browser = false\r\n  all_data_ready: Function = () => false\r\n  data_ready: Promise<void> = new Promise(resolve => {\r\n    this.all_data_ready = resolve\r\n  })\r\n  features: Features = {}\r\n  variables: Variables = {}\r\n  variable_codes: Variables = {}\r\n  variable_info: MeasureInfos = {}\r\n  references: References = {}\r\n  entities: Entities = {}\r\n  entity_tree: {[index: string]: Relations} = {}\r\n  meta: MetaTime = {\r\n    times: {},\r\n    variables: {},\r\n    ranges: {},\r\n    overall: {\r\n      range: [Infinity, -Infinity],\r\n      value: [],\r\n    },\r\n  }\r\n  loaded: LogicalObject = {}\r\n  inited: LogicalObject = {}\r\n  inited_summary: Promises = {}\r\n  summary_ready: {[index: string]: Function} = {}\r\n  entity_features: EntityFeatureSet = {}\r\n  data_maps: DataMaps = {}\r\n  data_queue: {[index: string]: {[index: string]: Function}} = {}\r\n  data_promise: {[index: string]: Function} = {}\r\n  data_processed: Promises = {}\r\n  load_requests: {[index: string]: string} = {}\r\n  retrieve = async function (this: DataHandler, name: string, url: string) {\r\n    if (!this.load_requests[name]) {\r\n      this.load_requests[name] = url\r\n      const f = new window.XMLHttpRequest()\r\n      f.onreadystatechange = () => {\r\n        if (4 === f.readyState) {\r\n          if (200 === f.status) {\r\n            this.ingest_data(JSON.parse(f.responseText), name)\r\n          } else {\r\n            throw new Error('DataHandler.retrieve failed: ' + f.responseText)\r\n          }\r\n        }\r\n      }\r\n      f.open('GET', url, true)\r\n      f.send()\r\n    }\r\n  }\r\n  format_value = formatter.value\r\n  format_label = formatter.label\r\n  ingest_data = ingester.data\r\n  ingest_map = ingester.map\r\n  load_id_maps = ingester.id_maps\r\n  init_summary = summary.init\r\n  calculate_summary = summary.calculate\r\n  map_variables = mapper.variables\r\n  map_entities = mapper.entities\r\n  parse_query = parser.query\r\n  export = exporter\r\n  get_variable = async function (this: DataHandler, variable: string, view: string): Promise<Variable> {\r\n    if (variable in this.variables) await this.calculate_summary(variable, view, true)\r\n    return this.variables[variable]\r\n  }\r\n  get_value = function vector(this: DataHandler, r: {variable: string; entity: Entity}): number[] {\r\n    if (this.variables[r.variable].is_time) {\r\n      return r.entity.time.value as number[]\r\n    } else {\r\n      const v = this.variables[r.variable].code\r\n      return (\r\n        v in r.entity.data ? (Array.isArray(r.entity.data[v]) ? r.entity.data[v] : [r.entity.data[v]]) : [NaN]\r\n      ) as number[]\r\n    }\r\n  }\r\n  public static retrievers = retrievers\r\n  public static checks = value_checks\r\n}\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","adopt","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","defaults","file_format","table_format","features","ID","Name","feature_conditions","variables","filter_by","conditions","options","filter_components","group_checks","includes","indexOf","excludes","export_checks","a","include","vars","i","value_checks","b","equals","s","vector_summary","vec","range","Array","isArray","Math","min","r","missing","first","Infinity","mean","sum","max","last","on","isNaN","Number","patterns","seps","comma","word_start","single_operator","greater","less","operator_start","component","number","non_letter_num","entity","time_range","feats","sep","_this","group","meta","times","time","tr_2","Object","keys","forEach","yn","k","vc","code","data","trange","NaN","join","op_1","time_1","tr_1","r_1","ranges","exporter","query_string","entities","in_browser","all_data","data_ready","_a","query","parse_query","params.options","params.defaults","row_writers","res","statusCode","headers","inc","split","exc","exclude","JSON","parse","stringify","rows","rw","bind","no_filter","no_feature_filter","in_group","dataset","operator","ii","format_label","variable_codes","name","tr","vi","overall","first_entity","id","filter","pass_1","substring","check","passes_feature_filter","adjs","c","info","co","time_component","passes_filter","filename","short_name","toLowerCase","replace","e_1","document","createElement","appendChild","rel","target","download","href","URL","createObjectURL","Blob","type","setTimeout","dispatchEvent","MouseEvent","revokeObjectURL","removeChild","is_time","d","row","offset","o","format_value","int","settings","digits","toFixed","l","w","toUpperCase","sets","loaded","site_file","schema","fields","ids","_meta","is_single","sort","datasets","views","full_name","measure","long_name","variable_info","load_id_maps","id_maps","metadata","has_map","map_1","map","data_maps","retrieved","resource","entity_features","map_entities","queue","map_content","entity_info","ingest_map","window","require","get","req","protocol","host","path","end","f_1","XMLHttpRequest","onreadystatechange","url","fi","readyState","status","Error","responseText","open","send","m","field","hooks","data_load","sort_a1","init","inited_summary","dataviews","view","order","selected_order","selected_summaries","summaries","state","table","ny","da_1","entity_count","at_1","Uint32Array","Uint16Array","Uint8Array","is_string_1","o_1","summary","rank","subset_rank","dak","ev","level_ids","freeze","eview","isFrozen","filled","q3","norm_median","break_median","lower_median_min","lower_median_range","upper_median_min","upper_median_range","norm_mean","break_mean","lower_mean_min","lower_mean_range","upper_mean_min","upper_mean_range","median","q1","mode","levels","seal","quantile","p","x","ap","bp","ceil","floor","calculate","full","data_processed","summaryId","init_summary","summary_ready","variable","s_1","selection","summary_selection","a_1","all","mo_1","mso_1","levels_1","level_ids_1","subset_1","n_selected","mss_1","ms_1","is_string_2","moy","msoy","oi","en","present","l_1","isFinite","bmd","bme","v_1","q1_1","data_queue","id_vars","vn","ve_1","ve_2","inited","retriever_1","DataHandler","retrievers","datasets_1","infos_1","si","overwrite_1","entity_tree","parents","children","rel_1","relations","id_length","sl","get_value","data_promise","onload","prototype","hasOwnProperty","all_data_ready","q","aq","aqi","test","exec","tf","checks","undefined","String","adj","multi","condition","dataview","references","load_requests","retrieve","ingest_data","formatter.value","formatter.label","ingester.data","ingester.map","ingester.id_maps","summary.init","calculate_summary","summary.calculate","map_variables","mapper.variables","mapper.entities","parser.query","export","get_variable","Window","measure_info","info_1","_references","partial_init","package","dp","resources","f_2"],"mappings":"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","x_google_ignoreList":[0]}